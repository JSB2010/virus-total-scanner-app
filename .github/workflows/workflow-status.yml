name: Workflow Status Dashboard

on:
  workflow_dispatch:
  schedule:
    # Run every day at 6 AM UTC
    - cron: '0 6 * * *'

jobs:
  workflow-status:
    name: Generate Workflow Status Dashboard
    runs-on: ubuntu-latest
    permissions:
      actions: read
      contents: read

    steps:
    - name: Check out Git repository
      uses: actions/checkout@v4

    - name: Generate workflow status report
      run: |
        echo "# ðŸš€ DropSentinel CI/CD Workflow Status Dashboard" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Generated**: $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "## ðŸ“‹ Available Workflows" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "### ðŸ”„ Active Workflows" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "| Workflow | Purpose | Triggers | Status |" >> $GITHUB_STEP_SUMMARY
        echo "|----------|---------|----------|--------|" >> $GITHUB_STEP_SUMMARY
        echo "| **CI** | Basic testing and validation | Push, PR | âœ… Active |" >> $GITHUB_STEP_SUMMARY
        echo "| **Optimized Build** | Fast cross-platform builds | Push, PR, Manual | âœ… Active |" >> $GITHUB_STEP_SUMMARY
        echo "| **Release** | Release management | Tags | âœ… Active |" >> $GITHUB_STEP_SUMMARY
        echo "| **Publish Packages** | GitHub Packages publishing | Release, Manual | âœ… Active |" >> $GITHUB_STEP_SUMMARY
        echo "| **CodeQL** | Security analysis | Push, PR, Schedule | âœ… Active |" >> $GITHUB_STEP_SUMMARY
        echo "| **Maintenance** | Dependency auditing | Schedule, Manual | âœ… Active |" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "### âš ï¸ Deprecated Workflows" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "| Workflow | Status | Replacement |" >> $GITHUB_STEP_SUMMARY
        echo "|----------|--------|-------------|" >> $GITHUB_STEP_SUMMARY
        echo "| **Legacy Build Packages** | âš ï¸ Deprecated | Use **Optimized Build** instead |" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "## ðŸŽ¯ Workflow Recommendations" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "### ðŸš€ For Development" >> $GITHUB_STEP_SUMMARY
        echo "- **Push to main/develop**: Triggers CI and Optimized Build workflows" >> $GITHUB_STEP_SUMMARY
        echo "- **Create PR**: Triggers CI, CodeQL, and Dependency Review" >> $GITHUB_STEP_SUMMARY
        echo "- **Manual builds**: Use 'Optimized Build' workflow with custom platform selection" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "### ðŸ“¦ For Releases" >> $GITHUB_STEP_SUMMARY
        echo "1. **Create release tag**: \`git tag v1.0.0 && git push origin v1.0.0\`" >> $GITHUB_STEP_SUMMARY
        echo "2. **Release workflow**: Automatically builds all platforms and creates GitHub release" >> $GITHUB_STEP_SUMMARY
        echo "3. **Package publishing**: Automatically publishes to GitHub Packages" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "### ðŸ”§ For Maintenance" >> $GITHUB_STEP_SUMMARY
        echo "- **Security audits**: Run automatically every Sunday" >> $GITHUB_STEP_SUMMARY
        echo "- **CodeQL analysis**: Run automatically on code changes and weekly" >> $GITHUB_STEP_SUMMARY
        echo "- **Manual maintenance**: Use 'Maintenance' workflow for on-demand audits" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "## âš¡ Performance Optimizations" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸŽ¯ Optimized Build Workflow Features" >> $GITHUB_STEP_SUMMARY
        echo "- **Parallel builds** across Windows, macOS, and Linux" >> $GITHUB_STEP_SUMMARY
        echo "- **Advanced caching** for dependencies and build artifacts" >> $GITHUB_STEP_SUMMARY
        echo "- **Configurable platforms** - build only what you need" >> $GITHUB_STEP_SUMMARY
        echo "- **Smart compression** with configurable levels" >> $GITHUB_STEP_SUMMARY
        echo "- **Enhanced logging** and build analytics" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "### ðŸ“Š Expected Performance Improvements" >> $GITHUB_STEP_SUMMARY
        echo "- âš¡ **40-50% faster builds** with caching" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ’¾ **70-90% cache hit rate** for incremental builds" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ’° **30-40% reduction** in GitHub Actions minutes" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ”„ **Parallel processing** utilizing all available resources" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "## ðŸ“¦ GitHub Packages Integration" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ“‹ Available Packages" >> $GITHUB_STEP_SUMMARY
        echo "- **NPM Package**: \`@jsb2010/dropsentinel\`" >> $GITHUB_STEP_SUMMARY
        echo "- **Container Images**: \`ghcr.io/jsb2010/dropsentinel\`" >> $GITHUB_STEP_SUMMARY
        echo "- **Binary Releases**: Available in GitHub Releases" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "### ðŸ”— Quick Installation" >> $GITHUB_STEP_SUMMARY
        echo "\`\`\`bash" >> $GITHUB_STEP_SUMMARY
        echo "# Install NPM package" >> $GITHUB_STEP_SUMMARY
        echo "npm install @jsb2010/dropsentinel" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "# Run with Docker" >> $GITHUB_STEP_SUMMARY
        echo "docker pull ghcr.io/jsb2010/dropsentinel:latest" >> $GITHUB_STEP_SUMMARY
        echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "## ðŸ› ï¸ Workflow Management" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "### ðŸ”§ Manual Workflow Triggers" >> $GITHUB_STEP_SUMMARY
        echo "1. **Go to Actions tab** in GitHub repository" >> $GITHUB_STEP_SUMMARY
        echo "2. **Select desired workflow** from the left sidebar" >> $GITHUB_STEP_SUMMARY
        echo "3. **Click 'Run workflow'** button" >> $GITHUB_STEP_SUMMARY
        echo "4. **Configure options** (if available) and run" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "### ðŸ“Š Monitoring Workflow Performance" >> $GITHUB_STEP_SUMMARY
        echo "- **Build times**: Monitor in workflow run summaries" >> $GITHUB_STEP_SUMMARY
        echo "- **Cache hit rates**: Check in build logs" >> $GITHUB_STEP_SUMMARY
        echo "- **Artifact sizes**: View in build summaries" >> $GITHUB_STEP_SUMMARY
        echo "- **Success rates**: Track in workflow history" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "## ðŸŽ‰ Next Steps" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "1. **Test optimized builds**: Push code to trigger new workflows" >> $GITHUB_STEP_SUMMARY
        echo "2. **Create a release**: Test the complete release pipeline" >> $GITHUB_STEP_SUMMARY
        echo "3. **Monitor performance**: Check build times and cache efficiency" >> $GITHUB_STEP_SUMMARY
        echo "4. **Use GitHub Packages**: Install and test published packages" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "---" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Status**: ðŸŽ‰ **All workflows optimized and ready for production!**" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Last Updated**: $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY

    - name: Check workflow files
      run: |
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "## ðŸ“ Workflow Files Status" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        cd .github/workflows
        for file in *.yml; do
          if [ -f "$file" ]; then
            lines=$(wc -l < "$file")
            size=$(du -h "$file" | cut -f1)
            
            case "$file" in
              "ci.yml") status="âœ… Active - Basic CI/CD" ;;
              "optimized-build.yml") status="ðŸš€ Active - Optimized builds" ;;
              "release.yml") status="ðŸ“¦ Active - Release management" ;;
              "release-analytics.yml") status="ðŸ“Š Active - Release analytics" ;;
              "codeql.yml") status="ðŸ”’ Active - Security analysis" ;;
              "maintenance.yml") status="ðŸ”§ Active - Maintenance tasks" ;;
              "build-packages.yml") status="âš ï¸ Deprecated - Use optimized-build.yml" ;;
              "workflow-status.yml") status="ðŸ“Š Active - Status dashboard" ;;
              *) status="â“ Unknown" ;;
            esac
            
            echo "- **$file** ($lines lines, $size) - $status" >> $GITHUB_STEP_SUMMARY
          fi
        done
